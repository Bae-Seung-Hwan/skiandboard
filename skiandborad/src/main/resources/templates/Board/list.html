<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/_head :: head}"></head>
<body>
<header th:replace="~{fragments/_nav :: nav}"></header>

<main class="page">

  <!-- 상단 헤더 영역 -->
  <section class="page-header">
    <div class="page-header__titles">
      <h1>커뮤니티 게시판</h1>
      <p class="page-header__subtitle">
        스키&보드 정보, 후기, 질문을 자유롭게 나눠보세요.
      </p>
    </div>

    <div class="page-header__meta">
      <!-- 로그인 한 사용자만 글쓰기 버튼 보이기 -->
      <a sec:authorize="isAuthenticated()"
         th:href="@{/board/new}"
         class="btn btn--primary">
        글쓰기
      </a>
      <a sec:authorize="isAnonymous()"
         th:href="@{/login}"
         class="btn btn--ghost">
        로그인 후 글쓰기
      </a>
    </div>
  </section>

  <!-- 검색 / 필터 영역 (GET /board?q=&category=) -->
  <section class="card board-filters">
    <form th:action="@{/board}" method="get" class="board-filters__form">
      <div class="board-filters__left">
        <div class="form-field">
          <label class="form-field__label">검색어</label>
          <div class="form-field__control">
            <input type="text"
                   name="q"
                   th:value="${param.q}"
                   placeholder="제목, 내용, 작성자로 검색"
                   class="input input--sm"/>
          </div>
        </div>

        <div class="form-field">
          <label class="form-field__label">카테고리</label>
          <div class="form-field__control">
            <select name="category" class="select select--sm">
              <option value="">전체</option>
              <option th:each="c : ${T(com.springboot.domain.BoardCategory).values()}"
                      th:value="${c}"
                      th:selected="${param.category != null and param.category[0] == c.name()}"
                      th:text="${c}">
              </option>
            </select>
          </div>
        </div>
      </div>

      <div class="board-filters__right">
        <button type="submit" class="btn btn--ghost btn--sm">적용</button>
      </div>
    </form>
  </section>

  <!-- 게시글 목록 카드 -->
  <section class="card board-list-card">
    <div class="board-list-header">
      <div class="board-list-header__left">
        <span class="board-list-header__badge">게시글</span>
        <span class="board-list-header__count"
              th:if="${page != null}"
              th:text="'총 ' + ${page.totalElements} + '개'">총 0개</span>
      </div>
    </div>

    <!-- 목록 -->
    <div class="board-list">
      <div class="board-list__row board-list__row--head">
        <div class="board-list__col board-list__col--category">분류</div>
        <div class="board-list__col board-list__col--title">제목</div>
        <div class="board-list__col board-list__col--author">작성자</div>
        <div class="board-list__col board-list__col--date">작성일</div>
        <div class="board-list__col board-list__col--views">조회</div>
      </div>

      <!-- 실제 데이터 -->
      <div class="board-list__row"
           th:each="p : ${page.content}">
        <div class="board-list__col board-list__col--category">
          <span class="chip chip--soft"
                th:text="${p.category()}">NOTICE</span>
        </div>

        <div class="board-list__col board-list__col--title">
          <a th:href="@{/board/{id}(id=${p.id()})}"
             class="board-list__title-link">
            <span th:text="${p.title()}">제목입니다</span>
          </a>
        </div>

        <div class="board-list__col board-list__col--author"
             th:text="${p.authorName()}">
          닉네임
        </div>

        <div class="board-list__col board-list__col--date"
             th:text="${#temporals.format(p.createdAt(), 'yyyy.MM.dd HH:mm')}">
          2025.11.23 01:23
        </div>

        <div class="board-list__col board-list__col--views"
             th:text="${p.viewCount()}">
          0
        </div>
      </div>

      <!-- 게시글 없을 때 -->
      <div class="board-list__empty"
           th:if="${page == null or page.totalElements == 0}">
        아직 등록된 게시글이 없습니다. 첫 글의 주인공이 되어 보세요!
      </div>
    </div>

    <!-- 페이지네이션 -->
    <nav class="pagination"
         th:if="${page != null and page.totalPages > 1}">
      <a class="pagination__btn"
         th:classappend="${page.first} ? ' is-disabled'"
         th:href="${page.first} ? '#' : @{/board(page=${page.number - 1}, q=${param.q}, category=${param.category})}">
        이전
      </a>

      <span class="pagination__pages">
        <a th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
           th:href="@{/board(page=${i}, q=${param.q}, category=${param.category})}"
           th:text="${i + 1}"
           th:class="'pagination__page' + (${page.number} == ${i} ? ' is-active' : '')">
          1
        </a>
      </span>

      <a class="pagination__btn"
         th:classappend="${page.last} ? ' is-disabled'"
         th:href="${page.last} ? '#' : @{/board(page=${page.number + 1}, q=${param.q}, category=${param.category})}">
        다음
      </a>
    </nav>
  </section>

</main>
</body>
</html>
