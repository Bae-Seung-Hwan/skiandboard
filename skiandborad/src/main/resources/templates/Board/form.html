<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/_head :: head}"></head>
<body>
<header th:replace="~{fragments/_nav :: nav}"></header>

<main class="page page--narrow" th:with="isCreate=${mode == 'create'}">

  <!-- 상단 헤더 영역 -->
  <section class="page-header">
    <div class="page-header__titles">
      <h1 th:text="${isCreate} ? '새 글 작성' : '글 수정'">새 글 작성</h1>
      <p class="page-header__subtitle"
         th:text="${isCreate} ? '스키&보드 이야기를 공유해 보세요.' : '작성한 글 내용을 수정할 수 있습니다.'">
        스키&보드 이야기를 공유해 보세요.
      </p>
    </div>
    <div class="page-header__meta">
      <a th:href="@{/board}" class="btn btn--ghost">← 목록으로</a>
    </div>
  </section>

  <!-- 카드 형태의 폼 -->
  <section class="card card--form">

    <!-- ✅ 글쓰기 폼 (create) -->
    <form th:if="${isCreate}"
          th:object="${form}"
          th:action="@{/board/new}"
          method="post"
          class="form">

      <input type="hidden"
             th:if="${_csrf != null}"
             th:name="${_csrf.parameterName}"
             th:value="${_csrf.token}"/>

      <!-- 제목 -->
      <div class="form-field">
        <label class="form-field__label">
          제목
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__control">
          <input type="text"
                 th:field="*{title}"
                 maxlength="120"
                 placeholder="제목을 입력하세요"
                 class="input"/>
        </div>
        <p th:if="${#fields.hasErrors('title')}"
           th:errors="*{title}"
           class="form-field__error"></p>
      </div>

      <!-- 카테고리 + 공개 여부 같은 느낌 -->
      <div class="form-row form-row--2col">
        <div class="form-field">
          <label class="form-field__label">카테고리</label>
          <div class="form-field__control">
            <select th:field="*{category}" class="select">
              <option value="" disabled selected>카테고리를 선택하세요</option>
              <option th:each="c : ${T(com.springboot.domain.BoardCategory).values()}"
                      th:value="${c}" th:text="${c}"></option>
            </select>
          </div>
        </div>

        <!-- 필요하면 향후 공개범위 등 넣는 자리 -->
        <div class="form-field form-field--placeholder">
          <label class="form-field__label">옵션</label>
          <div class="form-field__control form-field__hint">
            등록 후에도 수정할 수 있습니다.
          </div>
        </div>
      </div>

      <!-- 내용 -->
      <div class="form-field">
        <label class="form-field__label">
          내용
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__control">
          <textarea rows="14"
                    th:field="*{content}"
                    placeholder="스키장 정보, 후기, 팁 등을 자유롭게 작성해 주세요."
                    class="textarea"></textarea>
        </div>
        <p th:if="${#fields.hasErrors('content')}"
           th:errors="*{content}"
           class="form-field__error"></p>
      </div>

      <!-- 액션 버튼 -->
      <div class="form-actions">
        <button type="submit" class="btn btn--primary">등록</button>
        <a th:href="@{/board}" class="btn btn--ghost">취소</a>
      </div>
    </form>

    <!-- ✅ 수정 폼 (edit) -->
    <form th:unless="${isCreate}"
          th:object="${form}"
          th:action="@{/board/{id}/edit(id=${postId})}"
          method="post"
          class="form">

      <input type="hidden"
             th:if="${_csrf != null}"
             th:name="${_csrf.parameterName}"
             th:value="${_csrf.token}"/>

      <!-- 제목 -->
      <div class="form-field">
        <label class="form-field__label">
          제목
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__control">
          <input type="text"
                 th:field="*{title}"
                 maxlength="120"
                 placeholder="제목을 입력하세요"
                 class="input"/>
        </div>
        <p th:if="${#fields.hasErrors('title')}"
           th:errors="*{title}"
           class="form-field__error"></p>
      </div>

      <!-- 카테고리 -->
      <div class="form-row form-row--2col">
        <div class="form-field">
          <label class="form-field__label">카테고리</label>
          <div class="form-field__control">
            <select th:field="*{category}" class="select">
              <option th:each="c : ${T(com.springboot.domain.BoardCategory).values()}"
                      th:value="${c}" th:text="${c}"></option>
            </select>
          </div>
        </div>

        <div class="form-field form-field--placeholder">
          <label class="form-field__label">상태</label>
          <div class="form-field__control form-field__hint">
            수정 후 즉시 반영됩니다.
          </div>
        </div>
      </div>

      <!-- 내용 -->
      <div class="form-field">
        <label class="form-field__label">
          내용
          <span class="form-field__required">*</span>
        </label>
        <div class="form-field__control">
          <textarea rows="14"
                    th:field="*{content}"
                    placeholder="내용을 수정하세요."
                    class="textarea"></textarea>
        </div>
        <p th:if="${#fields.hasErrors('content')}"
           th:errors="*{content}"
           class="form-field__error"></p>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn--primary">수정</button>
        <a th:href="@{/board}" class="btn btn--ghost">취소</a>
      </div>
    </form>

  </section>
</main>
</body>
</html>
